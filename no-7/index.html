<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Banking UI (No Refresh)</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: 30px auto; }
  label { display:block; margin-top: 10px; font-weight: bold; }
  input, select { width: 100%; padding: 8px; margin-top: 4px; }
  button { margin-top: 15px; padding: 10px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #status { margin-top: 15px; padding: 10px; border-radius: 4px; background: #f3f4f6; white-space: pre-wrap; }
  .error { color: #b91c1c; }
  .success { color: #065f46; }
</style>
</head>
<body>
<h1>Banking UI</h1>

<label>Account (6 digits)
  <input type="text" id="account" placeholder="123456" maxlength="6">
</label>

<label>Action
  <select id="action">
    <option value="NEW">NEW</option>
    <option value="DEP">DEP</option>
    <option value="WDR">WDR</option>
    <option value="BAL">BAL</option>
  </select>
</label>

<label>Amount
  <input type="number" id="amount" value="0.00" step="0.01" min="0">
</label>

<button id="sendBtn">Send Request</button>

<div id="status">No request yet.</div>

<script>
const accountEl = document.getElementById('account');
const actionEl = document.getElementById('action');
const amountEl = document.getElementById('amount');
const statusEl = document.getElementById('status');
const sendBtn = document.getElementById('sendBtn');

// disable amount for BAL/NEW
actionEl.addEventListener('change', () => {
  if (actionEl.value === 'BAL' || actionEl.value === 'NEW') {
    amountEl.value = "0.00";
    amountEl.disabled = true;
  } else {
    amountEl.disabled = false;
  }
});

sendBtn.addEventListener('click', async () => {
  const account = accountEl.value.trim();
  const action = actionEl.value;
  let amount = parseFloat(amountEl.value || '0');

  // validate account
  if (!/^\d{6}$/.test(account)) {
    statusEl.textContent = "❌ Account must be exactly 6 digits.";
    statusEl.className = "error";
    return;
  }

  if (action === 'BAL' || action === 'NEW') amount = 0.0;

  const payload = { account, action, amount };

  sendBtn.disabled = true;
  statusEl.textContent = "⏳ Sending request...";
  statusEl.className = "";

  try {
    const res = await fetch("http://127.0.0.1:8000/banking", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok && data.status === "success") {
      statusEl.textContent = "✅ " + JSON.stringify(data, null, 2);
      statusEl.className = "success";
    } else {
      statusEl.textContent = "❌ " + JSON.stringify(data, null, 2);
      statusEl.className = "error";
    }
  } catch (err) {
    statusEl.textContent = "❌ Network error: " + err.message;
    statusEl.className = "error";
  } finally {
    sendBtn.disabled = false;
  }
});
</script>
</body>
</html>
